[gd_scene load_steps=23 format=3 uid="uid://dup2jh8uleo3l"]

[ext_resource type="Script" uid="uid://dc7w7oe3lm0eu" path="res://scripts/player.gd" id="1_u2qrv"]
[ext_resource type="Script" uid="uid://d350u8evihs1u" path="res://addons/netfox/rollback/rollback-synchronizer.gd" id="2_ktqdq"]
[ext_resource type="PackedScene" uid="uid://0by3fcnl3a5n" path="res://assets/characters/master/master_scene.tscn" id="2_v7wsi"]
[ext_resource type="Script" uid="uid://byrgwv2o7hstx" path="res://addons/netfox.extras/state-machine/rewindable-state-machine.gd" id="3_lo6j0"]
[ext_resource type="Script" uid="uid://dour8fehaaugp" path="res://addons/netfox/tick-interpolator.gd" id="4_a47yd"]
[ext_resource type="PackedScene" uid="uid://l1d8hwvn7hbq" path="res://scenes/player/camera_input.tscn" id="4_g37aj"]
[ext_resource type="Script" uid="uid://bbhybl3bvg0b6" path="res://scripts/states/movement/idle_state.gd" id="5_4l86x"]
[ext_resource type="Script" uid="uid://btj80uq43ccmt" path="res://scripts/states/movement/jump_state.gd" id="6_a47yd"]
[ext_resource type="Script" uid="uid://8ympfbj5i4hc" path="res://scripts/states/movement/fall_state.gd" id="8_4l86x"]
[ext_resource type="Script" uid="uid://dlfbk4aggn6u1" path="res://scripts/states/movement/move_state.gd" id="8_a47yd"]
[ext_resource type="Script" uid="uid://c8pgkna7f6aye" path="res://scripts/states/movement/ragdoll.gd" id="10_gjnd3"]
[ext_resource type="Script" uid="uid://ds61cf4l63bue" path="res://scripts/states/movement/interact.gd" id="10_h5dd4"]
[ext_resource type="Script" uid="uid://5oxt7p6a1uo8" path="res://scripts/player_input.gd" id="10_kusnb"]
[ext_resource type="PackedScene" uid="uid://qsh5m8pulul5" path="res://scripts/systems/HealthSystem.tscn" id="11_2hvjq"]
[ext_resource type="PackedScene" uid="uid://btdemgg0e0b4o" path="res://scenes/player/player_ui.tscn" id="12_ua4at"]
[ext_resource type="Script" uid="uid://d0r47oscrxt5o" path="res://scripts/states/movement/dead.gd" id="13_2hvjq"]
[ext_resource type="Script" uid="uid://r1boayxutr47" path="res://scripts/states/movement/static.gd" id="13_h5dd4"]
[ext_resource type="PackedScene" uid="uid://cf6jco7ctb45m" path="res://weapon_manager/weapons_manager.tscn" id="13_nrabn"]
[ext_resource type="PackedScene" uid="uid://dwphcc8ns8ypb" path="res://scripts/systems/HeatSystem.tscn" id="15_h5dd4"]

[sub_resource type="SceneReplicationConfig" id="SceneReplicationConfig_nrabn"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_y8poy"]
radius = 0.3
height = 1.5

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_2hvjq"]
radius = 0.15
height = 0.4

[node name="PlayerRootMotion" type="CharacterBody3D" node_paths=PackedStringArray("_player_input", "_camera_input", "_player_model", "_state_machine", "_tick_interpolator", "sync", "skeleton", "bones", "chest", "look_at_right", "look_at_left", "look_at_left_lower", "look_at_target", "health_system", "heat_system", "weapons_manager", "weapon_pivot", "player_ui")]
platform_on_leave = 2
platform_floor_layers = 0
script = ExtResource("1_u2qrv")
_player_input = NodePath("PlayerInput")
_camera_input = NodePath("CameraInput")
_player_model = NodePath("master")
_state_machine = NodePath("RewindableStateMachine")
_tick_interpolator = NodePath("TickInterpolator")
sync = NodePath("MultiplayerSynchronizer")
skeleton = NodePath("master/Armature/GeneralSkeleton")
bones = NodePath("master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D")
chest = NodePath("master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D/Physical Bone Chest")
look_at_right = NodePath("master/Armature/GeneralSkeleton/RightLow")
look_at_left = NodePath("master/Armature/GeneralSkeleton/LeftUp")
look_at_left_lower = NodePath("master/Armature/GeneralSkeleton/LeftLow")
look_at_target = NodePath("CameraInput/CameraMount/CameraRot/Holder")
health_system = NodePath("HealthSystem")
heat_system = NodePath("HeatSystem")
weapons_manager = NodePath("RightHandBoneAttachment/WeaponPivot/WeaponPivotFinal/WeaponsManager")
weapon_pivot = NodePath("RightHandBoneAttachment/WeaponPivot")
player_ui = NodePath("PlayerUi")

[node name="master" parent="." instance=ExtResource("2_v7wsi")]

[node name="Physical Bone Head" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="4"]
transform = Transform3D(-1, -3.18859e-07, -2.0366e-06, 1.99705e-06, 0.0950893, -0.995469, 5.11074e-07, -0.995469, -0.0950893, -0.00189784, 1.69693, -0.0542141)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.0452e-07, 2.98675e-06, 0.128854)
body_offset = Transform3D(-1, -1.85886e-07, -2.12838e-06, 2.10106e-06, 0.0950893, -0.995469, 3.8743e-07, -0.995469, -0.0950893, -3.0268e-08, 0.12827, 0.0122556)

[node name="Physical Bone LeftShoulder" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="5"]
transform = Transform3D(1.47643e-07, 0.220182, -0.975459, 0.0186213, 0.97529, 0.220144, 0.999827, -0.0181644, -0.00409994, 0.136431, 1.49516, -0.0690161)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.57175e-06, 5.58794e-07, 0.0722451)
body_offset = Transform3D(0.999827, -0.0181644, -0.00409983, 7.74861e-07, 0.220209, -0.975453, 0.0186213, 0.975284, 0.220171, 0.000290632, 0.0704716, -0.0159069)

[node name="Physical Bone LeftUpperArm" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="6"]
transform = Transform3D(0.000100764, -3.29169e-05, -1, 4.3273e-05, -1, 3.29213e-05, -1, -4.32763e-05, -0.000100763, 0.322715, 1.47925, -0.068704)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1.56678e-06, -2.94788e-06, 0.115814)
body_offset = Transform3D(1, 4.39297e-05, 9.99921e-05, 9.99942e-05, -4.76241e-05, -1, -4.39249e-05, 1, -4.76285e-05, -1.00136e-05, 0.115814, 8.46386e-06)

[node name="Physical Bone LeftLowerArm" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="7"]
transform = Transform3D(1.48264e-05, 4.02776e-06, -1, -1, 1.36869e-06, -1.48264e-05, 1.36863e-06, 1, 4.02778e-06, 0.558863, 1.47926, -0.068712)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.20285e-06, -2.36564e-06, 0.120359)
body_offset = Transform3D(1, -5.96039e-07, -8.94129e-08, -8.94105e-08, 4.79818e-06, -1, 5.96046e-07, 1, 4.79818e-06, -1.19209e-06, 0.120359, 1.78814e-06)

[node name="Physical Bone RightUpperArm" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="10"]
transform = Transform3D(2.20994e-06, -6.16166e-05, 1, 1.86028e-06, -1, -6.16166e-05, 1, 1.86041e-06, -2.20983e-06, -0.325404, 1.47927, -0.0686848)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -2.89343e-05, 5.55245e-06, 0.115843)
body_offset = Transform3D(1, 7.89785e-07, -8.04652e-07, -7.7486e-07, -2.68221e-06, -1, -7.89761e-07, 1, -2.6524e-06, 2.90275e-05, 0.115843, -5.24521e-06)

[node name="Physical Bone RightLowerArm" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="11"]
transform = Transform3D(6.941e-05, -4.82432e-06, 1, 1, -1.23103e-05, -6.941e-05, 1.23106e-05, 1, 4.82347e-06, -0.561523, 1.47929, -0.0687131)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.80275e-06, -1.11802e-06, 0.12036)
body_offset = Transform3D(1, -1.35004e-05, -5.0516e-06, -5.02172e-06, 6.3479e-06, -1, 1.35005e-05, 1, 6.31804e-06, 4.41074e-06, 0.12036, 3.57628e-07)

[node name="Physical Bone RightHand" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="12"]
transform = Transform3D(-3.96225e-05, -0.505844, 0.862625, -0.61449, 0.680558, 0.399051, -0.788924, -0.530059, -0.310863, -0.702711, 1.4697, -0.0611936)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.00734e-05, -2.60836e-05, 0.0241326)
body_offset = Transform3D(-0.787314, -0.531838, -0.311906, -3.72545e-07, 0.505887, -0.8626, 0.616552, -0.679137, -0.398292, 0.00754477, 0.02083, 0.00956941)

[node name="Physical Bone RightUpperLeg" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="13"]
transform = Transform3D(1, -3.3859e-06, -8.67435e-07, 7.62492e-07, -0.030872, 0.999523, -3.41106e-06, -0.999523, -0.030872, -0.0994099, 0.791876, -0.00339641)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.68838e-07, 1.84169e-05, 0.216832)
body_offset = Transform3D(-1, 3.26361e-06, 6.84414e-07, -5.86151e-07, 0.0300143, -0.99955, -3.28268e-06, -0.99955, -0.0300143, 3.20375e-07, 0.216734, 0.00652647)

[node name="Physical Bone RightLowerLeg" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="14"]
transform = Transform3D(-1, 6.43505e-07, -5.38691e-08, -1.13426e-07, -0.0929122, 0.995674, 6.35716e-07, 0.995674, 0.0929122, -0.099415, 0.353654, -0.0173923)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -5.41407e-06, 1.64844e-06, 0.222471)
body_offset = Transform3D(-1, 5.007e-07, 1.11704e-07, -6.42613e-08, 0.0937697, -0.995594, -5.08968e-07, -0.995594, -0.0937697, -5.43892e-06, 0.221491, 0.0208627)

[node name="Physical Bone RightFoot" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="15"]
transform = Transform3D(-0.981243, 0.142516, 0.129815, 0.192777, 0.725398, 0.660783, 4.76791e-06, 0.673414, -0.739266, -0.112391, 0.0661491, 0.0358695)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1.38562e-05, -5.24409e-05, 0.0999545)
body_offset = Transform3D(0.981243, -0.142516, -0.129816, 4.56488e-06, 0.673414, -0.739265, 0.192777, 0.725398, 0.660783, 0.0129818, 0.0739283, -0.0660076)

[node name="Physical Bone LeftUpperLeg" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="16"]
transform = Transform3D(1, 3.11138e-06, -4.96549e-08, 1.45701e-07, -0.0308768, 0.999523, 3.10837e-06, -0.999523, -0.0308768, 0.0961859, 0.791922, -0.00342015)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.16457e-06, -4.94579e-06, 0.216787)
body_offset = Transform3D(-1, -3.22928e-06, -1.28642e-07, 3.1665e-08, 0.0300125, -0.99955, 3.23169e-06, -0.99955, -0.0300125, -3.13669e-06, 0.21669, 0.00650138)

[node name="Physical Bone LeftLowerLeg" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="17"]
transform = Transform3D(-1, 3.38247e-06, 4.36348e-06, 4.03032e-06, -0.0929144, 0.995674, 3.77327e-06, 0.995674, 0.0929144, 0.0961777, 0.353623, -0.0173882)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -4.22321e-06, -2.8871e-06, 0.222501)
body_offset = Transform3D(-1, 3.24439e-06, 4.52629e-06, -4.20213e-06, 0.0937673, -0.995594, -3.65451e-06, -0.995594, -0.0937673, -5.23031e-06, 0.221521, 0.0208605)

[node name="Physical Bone LeftFoot" parent="master/Armature/GeneralSkeleton/PhysicalBoneSimulator3D" index="18"]
transform = Transform3D(-0.981228, -0.14257, -0.129869, -0.192852, 0.725395, 0.660765, 9.92004e-07, 0.673406, -0.739273, 0.109171, 0.0660818, 0.0358699)
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.1893e-06, -1.13994e-06, 0.0999997)
body_offset = Transform3D(0.981228, 0.14257, 0.129868, 9.23872e-07, 0.673406, -0.739273, -0.192852, 0.725395, 0.660765, -0.0129878, 0.0739278, -0.0660752)

[node name="RollbackSynchronizer" type="Node" parent="." node_paths=PackedStringArray("root")]
script = ExtResource("2_ktqdq")
root = NodePath("..")
state_properties = Array[String]([":transform", "master:transform", "RewindableStateMachine:state", ":velocity"])
input_properties = Array[String](["PlayerInput:input_dir", "PlayerInput:jump_input", "PlayerInput:run_input", "CameraInput:camera_basis", "CameraInput:camera_look", "PlayerInput:shoot_input"])
enable_input_broadcast = false
metadata/_custom_type_script = "uid://d350u8evihs1u"

[node name="MultiplayerSynchronizer" type="MultiplayerSynchronizer" parent="."]
replication_config = SubResource("SceneReplicationConfig_nrabn")

[node name="RewindableStateMachine" type="Node" parent="."]
script = ExtResource("3_lo6j0")
metadata/_custom_type_script = "uid://byrgwv2o7hstx"

[node name="Idle" type="Node" parent="RewindableStateMachine" node_paths=PackedStringArray("camera_input", "player_input", "parent")]
script = ExtResource("5_4l86x")
animation_name = "rifle aiming idle"
camera_input = NodePath("../../CameraInput")
player_input = NodePath("../../PlayerInput")
parent = NodePath("../..")

[node name="Interact" type="Node" parent="RewindableStateMachine" node_paths=PackedStringArray("camera_input", "player_input", "parent")]
script = ExtResource("10_h5dd4")
animation_name = "rifle aiming idle"
camera_input = NodePath("../../CameraInput")
player_input = NodePath("../../PlayerInput")
parent = NodePath("../..")

[node name="Jump" type="Node" parent="RewindableStateMachine" node_paths=PackedStringArray("camera_input", "player_input", "parent")]
script = ExtResource("6_a47yd")
animation_name = "walking"
camera_input = NodePath("../../CameraInput")
player_input = NodePath("../../PlayerInput")
parent = NodePath("../..")

[node name="Move" type="Node" parent="RewindableStateMachine" node_paths=PackedStringArray("camera_input", "player_input", "parent")]
script = ExtResource("8_a47yd")
camera_input = NodePath("../../CameraInput")
player_input = NodePath("../../PlayerInput")
parent = NodePath("../..")

[node name="Fall" type="Node" parent="RewindableStateMachine" node_paths=PackedStringArray("camera_input", "player_input", "parent")]
script = ExtResource("8_4l86x")
animation_name = "walking"
camera_input = NodePath("../../CameraInput")
player_input = NodePath("../../PlayerInput")
parent = NodePath("../..")

[node name="Ragdoll" type="Node" parent="RewindableStateMachine" node_paths=PackedStringArray("camera_input", "player_input", "parent")]
script = ExtResource("10_gjnd3")
animation_name = "rifle aiming idle"
camera_input = NodePath("../../CameraInput")
player_input = NodePath("../../PlayerInput")
parent = NodePath("../..")
metadata/_custom_type_script = "uid://c1xw0v7hky5kl"

[node name="Dead" type="Node" parent="RewindableStateMachine" node_paths=PackedStringArray("camera_input", "player_input", "parent")]
script = ExtResource("13_2hvjq")
animation_name = "rifle aiming idle"
camera_input = NodePath("../../CameraInput")
player_input = NodePath("../../PlayerInput")
parent = NodePath("../..")
metadata/_custom_type_script = "uid://c1xw0v7hky5kl"

[node name="Static" type="Node" parent="RewindableStateMachine" node_paths=PackedStringArray("camera_input", "player_input", "parent")]
script = ExtResource("13_h5dd4")
camera_input = NodePath("../../CameraInput")
player_input = NodePath("../../PlayerInput")
parent = NodePath("../..")
metadata/_custom_type_script = "uid://usyufdtn83hc"

[node name="TickInterpolator" type="Node" parent="." node_paths=PackedStringArray("root")]
script = ExtResource("4_a47yd")
root = NodePath("..")
properties = Array[String]([":velocity", ":transform", "master:transform"])
metadata/_custom_type_script = "uid://dour8fehaaugp"

[node name="HealthSystem" parent="." instance=ExtResource("11_2hvjq")]
regen_enabled = true

[node name="HeatSystem" parent="." instance=ExtResource("15_h5dd4")]

[node name="PlayerUi" parent="." node_paths=PackedStringArray("weapons_manager") instance=ExtResource("12_ua4at")]
weapons_manager = NodePath("../RightHandBoneAttachment/WeaponPivot/WeaponPivotFinal/WeaponsManager")

[node name="PlayerInput" type="Node" parent="."]
script = ExtResource("10_kusnb")

[node name="CameraInput" parent="." instance=ExtResource("4_g37aj")]

[node name="BodyCollision" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.769434, 0)
shape = SubResource("CapsuleShape3D_y8poy")

[node name="HeadCollision" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.65716, 0)
shape = SubResource("CapsuleShape3D_2hvjq")

[node name="RightHandBoneAttachment" type="BoneAttachment3D" parent="."]
transform = Transform3D(4.2106e-07, -1, -6.43311e-05, -0.00261617, 6.43e-05, -0.999996, 0.999996, 5.59571e-07, -0.00261617, -0.68188, 1.47929, -0.0687134)
bone_name = "RightHand"
bone_idx = 35
use_external_skeleton = true
external_skeleton = NodePath("../master/Armature/GeneralSkeleton")

[node name="WeaponPivot" type="Marker3D" parent="RightHandBoneAttachment"]

[node name="WeaponPivotFinal" type="Marker3D" parent="RightHandBoneAttachment/WeaponPivot"]
transform = Transform3D(-2.84053e-08, 0, 1, 0, 0.999999, 1.11759e-07, -1, 2.23517e-08, -5.68107e-08, 0.285775, -0.13041, 0.574644)

[node name="WeaponsManager" parent="RightHandBoneAttachment/WeaponPivot/WeaponPivotFinal" node_paths=PackedStringArray("player_hud", "player") instance=ExtResource("13_nrabn")]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0.410812, -0.213233, 0.115377)
player_hud = NodePath("../../../../PlayerUi")
player = NodePath("../../../..")

[node name="RootMotionView" type="RootMotionView" parent="."]
animation_path = NodePath("../master/AnimationPlayer")

[editable path="master"]
